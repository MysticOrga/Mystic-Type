Mystic-Type Stress Tests (TCP/UDP authoritative server + raylib client)
Generated: focus on networking, simulation, IPC, client render, and lobby flows.

Scope summary (surfaces to stress):
- TCP: handshake, lobby selection, heartbeat, chat/messages, PING/PONG, TCP framing.
- UDP: HELLO_UDP, INPUT, SHOOT, SNAPSHOT broadcast, simulation tick.
- GameWorld: collisions, bullets, monsters, boss spawn, shared lobby score.
- IPC: TCP<->UDP child process signaling (dead/boss spawn).
- Client: render loop, ECS updates, input, chat UI, snapshot parsing.
- Child process mgmt: spawn/track UDP servers per lobby.

General instrumentation to collect during all tests:
- Server CPU/RAM, per-process CPU, active sockets, FD count.
- UDP tick timing, snapshot interval jitter, and drop counts.
- TCP backlog, PING/PONG RTT distribution, disconnect rate.
- Client FPS, frame time spikes, render/update time.
- Logs for disconnects, lobby join/leave, IPC errors.

Environment matrix (run a subset across):
- 1/2/4 clients, local LAN, high latency (100-300ms), jitter (20-50ms), packet loss (1-10%).
- macOS/Linux, Debug/Release builds.
- Public lobby vs private lobby.

------------------------
TCP Stress Tests
------------------------
1) 200 sequential TCP connects/disconnects in 60s; ensure no FD leaks.
2) Burst connect: 4 clients connect at once; all get SERVER_HELLO/OK within 1s.
3) Handshake timeout: client connects but never sends CLIENT_HELLO; ensure timeout and cleanup.
4) Invalid CLIENT_HELLO payload (missing "toto"); expect REFUSED.
5) TCP framing fuzz: invalid length prefix (too large) -> server should not crash.
6) PING/PONG storm: server sends PING every 1s; client always responds; verify RTT updates stable.
7) Missing PONG: simulate client ignoring PING; server disconnects after timeout.
8) TCP slow sender: client sends chat messages one byte at a time; server still parses.
9) TCP slow receiver: throttle client socket receive; ensure server does not block.
10) TCP_NODELAY behavior: compare chat latency with/without Nagle (baseline).
11) Multiple TCP packets in one read: ensure server parses and processes all quickly.
12) TCP spam: 1000 chat messages in 10s; ensure rate control or CPU safe.

------------------------
Lobby / Matchmaking Stress Tests
------------------------
13) Auto-join PUBLIC lobby from 4 clients simultaneously; all see player list.
14) Create/join private lobby with random codes; server spawns per-lobby UDP child.
15) Join invalid lobby code; proper LOBBY_ERROR.
16) Flood create/join: 100 create/join cycles; no stale lobbies left.
17) Rapid lobby switching: 4 clients switch lobbies every 5s; no ghost players.
18) Lobby full (MAX_CLIENT): 5th client is refused; existing lobby stable.
19) UDP child spawn race: join lobby while UDP child still booting; clients should recover.
20) Lobby code collision test: forced duplicate codes (mock) -> safe handling.

------------------------
UDP Transport Stress Tests
------------------------
21) HELLO_UDP flood: 1000 HELLOs in 5s; no crash.
22) HELLO_UDP from unknown ids; ignored or safe.
23) INPUT spam: 200 inputs/sec from 1 client; rate limiting should cap.
24) SHOOT spam: 100 shots/sec; rate limiting should cap.
25) UDP packet loss 5%/10%: verify game remains playable, no crash.
26) UDP reordering: shuffle packets; server authority should be stable.
27) UDP duplication: duplicate INPUT/SHOOT; no double-shoot bug.
28) Large UDP packet fuzz: oversized buffer; packet parser rejects.
29) NAT simulation: HELLO_UDP from changed port; server updates session or ignores.
30) Snapshot size max: many bullets+monsters+players; still < UDP buffer.

------------------------
Snapshot / State Stress Tests
------------------------
31) Snapshot interval jitter: vary load; ensure snapshots still at interval.
32) Snapshot parsing: client handles malformed snapshots gracefully.
33) Snapshot backlog: client receives multiple snapshots quickly; process all in order.
34) Snapshot vs render: 60 FPS target, snapshots 20 FPS; no stutter.
35) Player list vs snapshot: join mid-game; client merges correctly.
36) Snapshot compatibility: older client format (if applicable) should not crash.
37) Disconnect while snapshot: player removed cleanly; no stale entity.
38) Snapshot under packet loss: last known state remains stable.

------------------------
Gameplay / Simulation Stress Tests
------------------------
39) 4 players continuous movement for 10 min; no drift/teleport issues.
40) 4 players shoot continuously for 5 min; no bullet leaks.
41) 200 active bullets on screen; performance stable.
42) 100 monsters alive; CPU stable, no freeze.
43) Collision storm: bullets hitting multiple monsters; correct score increments.
44) Player damage cooldown: sustained collision with monster; HP ticks correctly.
45) Player death handling: dead player removed, lobby state updated.
46) Respawn/ reconnect test: player dies then reconnects; no ghost state.
47) Shared lobby score: verify score increments once per kill and shared across players.
48) Score overflow: force score beyond 65535; clamps safely.
49) Boss spawn threshold (score=250): boss spawns once per lobby.
50) Boss remains on screen; movement stays within bounds.
51) Boss bullet spam: sustained fire; no server crash.
52) Boss + players + monsters: ensure no freeze and correct collisions.

------------------------
Chat / Messaging Stress Tests (TCP)
------------------------
53) Chat flood: 200 messages in 30s; server stays responsive.
54) Long messages (120 chars): truncated or sent intact.
55) Non-ASCII/invalid bytes: sanitized; no crash.
56) Chat while disconnecting: sender disconnects mid-send; no server crash.
57) Chat broadcast to lobby only: only lobby peers receive.
58) Chat across lobbies: no leakage.
59) System messages: death/boss spawn show to lobby instantly.
60) Chat UI spam: open/close chat rapidly; no input lock-up.
61) Chat input + movement: movement should pause while chat active.
62) Chat echo: sender sees own message immediately; others receive once.

------------------------
Ping / Heartbeat Stress Tests
------------------------
63) PING every 1s with timestamp; RTT stable under load.
64) Artificial client delay on PONG; server RTT reflects delay.
65) Client freeze 5s; server disconnects after heartbeat timeout.
66) Many clients (4) with different RTT; UI shows per-player values.
67) Ping spikes (network jitter); UI updates without flicker.

------------------------
IPC / Child Process Stress Tests
------------------------
68) UDP child crash: parent detects missing IPC; lobby cleanup.
69) IPC path missing/unlink error: server logs error, continues.
70) IPC message burst (DEAD/BOSS): TCP handles immediately, no backlog.
71) Multiple lobbies with active IPC: messages routed to correct lobby.

------------------------
Process Management / Spawn Stress Tests
------------------------
72) Spawn 20 lobbies quickly; ensure child process limit is respected.
73) Rapid lobby creation/deletion; no orphan child processes.
74) UDP server restart while clients connected; clients recover/timeout cleanly.
75) SIGTERM on UDP child: parent handles gracefully.

------------------------
Client Render / ECS Stress Tests
------------------------
76) 4 players + many bullets + monsters; FPS stays above target.
77) Minimize/restore window repeatedly; no crash.
78) Resize window; UI scaling consistent.
79) Sprite load failure (missing files); client handles without crash.
80) Input spam while chat active; no stuck keys.
81) Pseudo entry rapid typing; no freeze.

------------------------
Protocol Robustness / Fuzzing
------------------------
82) Random TCP payloads (fuzz) to server; server ignores or refuses.
83) Random UDP payloads (fuzz) to server; no crash.
84) Invalid PacketType values; ignored safely.
85) Corrupt magic header; packet rejected.
86) Zero-length payload for expected data; safe ignore.

------------------------
Resource / Soak Tests
------------------------
87) 1 hour soak: 4 clients moving/shooting; no memory growth.
88) Repeated connect/disconnect cycles (1000); no FD leaks.
89) High CPU load on server host; ensure graceful degradation.
90) Low memory simulation; no crashes.

------------------------
Regression Scenarios
------------------------
91) Chat after lobby change: ensure broadcast targets correct lobby.
92) Score after boss spawn: still increments, no double spawn.
93) PING payload changes: old clients still respond (if compatibility needed).
94) Player list and snapshots after network interruptions; no duplicates.

Notes for execution:
- For network conditions, use tc/netem or a local proxy (Clumsy/Network Link Conditioner).
- For load, use multiple client instances or a headless bot if available.
- For fuzzing, a simple Python UDP/TCP sender is sufficient.

Bot coverage (scripts/stress_bot.py + scripts/stress_run.sh):
- Covered by bot (directly): 1, 2, 3, 6, 7, 8, 9, 10, 11, 12,
  13, 14, 16, 17, 18,
  21, 22, 23, 24, 25, 26, 27, 28,
  31, 33, 34, 35, 37, 38,
  39, 40, 41, 43, 45, 47,
  53, 54, 55, 56, 57, 58, 59, 60, 61, 62,
  63, 64, 65, 66, 67,
  72, 73, 74, 75,
  82, 83, 84, 85, 86,
  87, 88, 89
- Partially covered (needs manual/extra tooling): 4, 5, 15, 19, 20, 29, 30, 32, 36,
  42, 44, 46, 48, 49, 50, 51, 52,
  68, 69, 70, 71, 76, 77, 78, 79, 80, 81, 90, 91, 92, 93, 94
